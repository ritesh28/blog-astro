---
import Tags from "@/components/Tags.astro";
import ChevronUp from "@/images/simple-icons/chevron-up.svg";
import LeftArrow from "@/images/simple-icons/left-arrow.svg";
import MainLayout from "@/layouts/MainLayout.astro";
import { formatDate } from "@/utils/formatDate";
import { getEntry } from "astro:content";
import { readingTime } from "reading-time-estimator";

const { slug } = Astro.params;
if (!slug) return Astro.redirect("/404");

const entry = await getEntry("blog", slug);
if (!entry) return Astro.redirect("/404");

const { Content, headings } = await entry.render();
---

<MainLayout title={entry.data.title}>
  <article class="prose dark:prose-invert lg:prose-xl mx-auto px-4 lg:px-6">
    <a
      href="/blogs"
      class="not-prose text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center my-6 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"
    >
      <LeftArrow
        class="w-3.5 h-3.5 me-2"
        aria-hidden="true"
        fill="currentColor"
      />
      Back To Blogs
    </a>

    <h1>{entry.data.title}</h1>
    <p class="font-bold -mt-6!">{formatDate(entry.data.pubDate)}</p>
    <p class="text-gray-500 -mt-8!">{readingTime(entry.body).text}</p>
    <div class="not-prose">
      <Tags tags={entry.data.tags} />
    </div>
    <img
      src={entry.data.imageURL}
      alt="blog image"
      class="w-full h-auto rounded-xl my-6"
    />
    <div class="not-prose mb-10">
      <div id="accordion-collapse" data-accordion="collapse">
        <h2 id="accordion-collapse-heading-1">
          <button
            type="button"
            class="flex items-center justify-between w-full p-5 font-medium rtl:text-right text-gray-500 border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 gap-3"
            data-accordion-target="#accordion-collapse-body-1"
            aria-expanded="true"
            aria-controls="accordion-collapse-body-1"
          >
            <span>Table of Contents</span>
            <ChevronUp
              data-accordion-icon
              class="w-3 h-3 rotate-180 shrink-0"
              aria-hidden="true"
            />
          </button>
        </h2>
        <div
          id="accordion-collapse-body-1"
          class="hidden"
          aria-labelledby="accordion-collapse-heading-1"
        >
          <div
            class="p-5 border border-b-1 border-gray-200 dark:border-gray-700 dark:bg-gray-900"
          >
            <ul>
              {
                headings.map((heading) => (
                  <li>
                    <a
                      href={`#${heading.slug}`}
                      class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                      style={{ marginLeft: `${(heading.depth - 1) * 2}rem` }}
                    >
                      {heading.text}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </div>
    </div>
    <Content />
  </article>
</MainLayout>
